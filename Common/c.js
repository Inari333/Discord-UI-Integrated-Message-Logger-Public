function e(e,t){_enableObserver=!1,e.before(t),_enableObserver=!0}function t(e,t){_enableObserver=!1,e.appendChild(t),_enableObserver=!0}function n(e){_enableObserver=!1,e.remove(),_enableObserver=!0}function l(e){return[...e.childNodes].filter(e=>e.nodeType===Node.TEXT_NODE||!(e.nodeType===Node.ELEMENT_NODE&&e.className.includes("timestamp"))).map(e=>e.textContent).join("").trim()}const o="https://inari-discord-api-emhndjbwfqc4enfz.canadaeast-01.azurewebsites.net",r=Object.freeze({FREE:0,BASIC:1,PREMIUM:2});async function i(e,t){const n=await chrome.runtime.sendMessage({type:"PAY_FROM_DISCORD_MESSAGE_LOGGER",planLevel:e,key:pe});n?.success?window.open(n.url,"_blank"):t&&t()}async function s(e,t){const n=await chrome.runtime.sendMessage({type:"KEY_CHECK_FROM_DISCORD_MESSAGE_LOGGER",key:e});return n?.success?n.level:(t&&t(),0)}function a(e){if(null!=e)return null!=ye&&null!=ye||(v(),null==ye&&le.get("activeUserId",e=>{ye=e.activeUserId})),g(e)==ye||null!=e.querySelector('[id^="message-content"][class*="isSending"]')}function c(e){return null!=ve[ge].contentsById[e.id]&&null!=ve[ge].contentsById[e.id]&&(ve[ge].contentsById[e.id].allEdit.length>0&&!a(ve[ge].contentsById[e.id].element))}function u(e,t){return e.original!=t&&e.lastEdit!=t}function d(e){return null!=e.closest('[class*="repliedMessage"]')}function f(e){return null!=e.closest('[aria-describedby*="message-reply"]')}function m(e,t){return null!=e&&null!=e&&null!=e.element&&null!=e.element&&e.date>=t}function y(e){return e.id.match(/\d+/)[0]}function v(){const e=document.querySelector('[class*="avatarWrapper"][aria-label="Set Status"] img[class*="avatar"]')?.src,t=e?.split("/avatars/")[1]?.split("/")[0];return t&&(ye=t,Q(t)),t}function g(e){const t=e.parentElement?.querySelector('img[class*="avatar"]')?.src;return t?.split("/avatars/")[1]?.split("/")[0]}function I(){return document.querySelectorAll('[id^="message-content"]:not([id^="message-content-Uploader"]):not([class*="repliedTextContent"]):not(.isDeleted)')}function h(e){if(null==e||null==e)return null;var t=null;return document.querySelectorAll('ol[class*="scrollerInner"] li:not([id^="deleted-"]) time').forEach(n=>{new Date(n.getAttribute("datetime"))<p(e)&&(t=n.closest("li"))}),t}function p(e){var t=e.querySelector("time");return null==t||null==t.getAttribute("datetime")?null:new Date(t.getAttribute("datetime"))}function b(e){return e.matches('[class*="chat"]')?e:e.querySelector('[class*="chat"]')}function E(){return document.querySelector('div[class*="page"] div[class*="scroller"]')}var w,B,S,x=0;function M(){ge!=window.location.pathname&&(Ie=ge,ge=window.location.pathname,x=0,null==ve[ge]&&(ve[ge]={contentsById:{},contentIdsByIndex:[]}))}function D(){O(),I().forEach(e=>{var t=l(e),n=ve[ge].contentsById[e.id];null==n?_(e,t):(n.isDeleted=!1,u(n,t)&&(n.lastEdit=t,n.allEdit.push(t)),L(e,t))}),k(),K(),A()}function O(){w=U(),B=G(),S=j();for(var e=ve[ge].contentsById,t=ve[ge].contentIdsByIndex,n=w.leftIndex;n<=w.rightIndex;n++)e[t[n]].isDeleted=!0}function _(e,t){if(he=C(),!(-1!=re[oe]&&he>=re[oe])){ve[ge].contentsById[e.id]={original:t,lastEdit:"",allEdit:[],isDeleted:!1,element:null,date:null};var n=z(e);ve[ge].contentIdsByIndex.splice(n,0,e.id),N(e),ce=!0}}function A(){var e=ve[ge].contentIdsByIndex.length;e!=x&&(x=e)}function C(){return Object.values(ve).reduce((e,t)=>e+t.contentIdsByIndex.length,0)}function L(t,n){if(c(t)){var l="saved-"+t.id,o=document.getElementById(l),r=ve[ge].contentsById[t.id];if(u(r,n)||null==o){null==o?((o=document.createElement("div")).id=l,o.className=t.className,e(t,o),t.style.display="none"):o.replaceChildren(),q(t,o,r.original," (original)");var i=ve[ge].contentsById[t.id].allEdit;i.forEach((e,n)=>{1==i.length?q(t,o,e," (edited)"):q(t,o,e," (edited "+(n+1)+")")}),N(t)}}}function N(e){if(null==e.closest("li"))return ve[ge].contentsById[e.id].element=null,void(ve[ge].contentsById[e.id].date=null);var t=e.closest("li").cloneNode(!0);ve[ge].contentsById[e.id].element=t,ve[ge].contentsById[e.id].element.id="deleted-"+ve[ge].contentsById[e.id].element.id,ve[ge].contentsById[e.id].element.querySelectorAll('[id^="message-content"]').forEach(e=>{e.classList.add("isDeleted")}),ve[ge].contentsById[e.id].date=p(t),R(ve[ge].contentsById[e.id].element)}function k(){if(null!=document.querySelector('ol[class*="scrollerInner"]'))for(var e=w.leftIndex;e<=w.rightIndex;e++){var l=ve[ge].contentIdsByIndex[e],o=ve[ge].contentsById[l];if(null!=o.element&&null!=o.element)if(o.isDeleted&&null==document.getElementById(o.element.id)&&!a(o.element)&&m(o,B)){var r=h(o.element);null!=r&&(t(r,o.element),T(o.element))}else o.isDeleted||null==document.getElementById(o.element.id)||n(o.element)}}function T(t){var n=document.createElement("div");n.className="messageHoverInfo",n.textContent=`Message ID : ${y(t)}`,e(t,n)}function q(e,n,l,o){var r=e.querySelector('span[class*="edited"]');if(null!=r){var i=document.createElement("div");if(i.textContent=l,null!=o){var s=document.createElement("span");s.className=r.className,s.style.color="var(--text-muted)",s.textContent=o,t(i,s)}t(n,i)}}function R(){}function G(){var e=document.querySelector('ol[class*="scrollerInner"] li:not([id^="deleted-"]) time');return null==e?null:e.hasAttribute("datetime")?new Date(e.getAttribute("datetime")):null}function j(){if(!H(E())){var e=document.querySelector('ol[class*="scrollerInner"] li:not([id^="deleted-"]):last-of-type time');return null==e?null:e.hasAttribute("datetime")?new Date(e.getAttribute("datetime")):null}return null}function H(e,t=50){return null==e||null==e||e.scrollHeight-e.scrollTop-e.clientHeight<=t}function U(){var e=ve[ge].contentIdsByIndex,t=ve[ge].contentsById;if(!e||0===e.length)return{leftIndex:0,rightIndex:-1};for(var n=0,l=e.length;n<l;){const o=n+l>>1,r=t[e[o]];if(!r||null===r.date)break;r.date<B?n=o+1:l=o}const o=n;var r=e.length-1;if(null!=S){for(n=o,l=e.length;n<l;){const o=n+l>>1,r=t[e[o]];if(!r||null==r.date)break;r.date<=S?n=o+1:l=o}r=n-1}return{leftIndex:o,rightIndex:r}}function z(e){var t=e.closest("li"),n=new Date(p(t)),l=ve[ge].contentIdsByIndex,o=ve[ge].contentsById;if(!l||0===l.length)return 0;for(var r=0,i=l.length;r<i;){const e=r+i>>1,t=o[l[e]];if(!t||null===t.date)break;t.date<n?r=e+1:i=e}return r}chrome.runtime.onMessage.addListener((e,t,n)=>{if("DELETE_ALL_LOGS"===e.type)X(),n({success:!0})});const F=()=>new Promise(e=>setTimeout(e,0));async function P(e){await F();const t=fe.encode(e),n=te?pako.deflateRaw(t,{level:ee}):pako.deflate(t,{level:ee});let l="";for(let e=0;e<n.length;e+=32768)await F(),l+=String.fromCharCode(...n.subarray(e,e+32768));return btoa(l)}function W(e){const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);const l=te?pako.inflateRaw(n):pako.inflate(n);return me.decode(l)}async function J(){performance.now();const e=ve[ge];if(!e)return;const t=JSON.stringify(e,(e,t)=>"element"===e&&t?t.outerHTML:t);if(de=t,!ue){ue=ne;const e=await P(t),n=`logs-${ge}`;le.set({[n]:e},()=>{ue=!1,de!==t&&J()})}}function K(){ce&&(ce=!1,J(),$(he))}function Y(e){le.get(null,t=>{for(const e in t)if(e.startsWith("logs-")){const n=e.substring(5),l=W(t[e]);ve[n]=JSON.parse(l,(e,t)=>{if("element"===e&&"string"==typeof t){const e=document.createElement("div");return e.innerHTML=t,e.firstChild}return"date"===e&&"string"==typeof t?new Date(t):t})}e&&e()})}function X(){ve={},ge=null,M(),le.get(null,e=>{const t=Object.keys(e).filter(e=>e.startsWith("logs-"));le.remove(t,()=>{$(0)})})}function $(e){le.set({logsCount:e})}function Q(e){le.set({activeUserId:e})}var V=100,Z=500,ee=6,te=!0,ne=!1;const le=("undefined"!=typeof browser?browser:chrome).storage.local;var oe=0;const re=[Math.round(Math.pow(22.36,2)),Math.round(Math.pow(44.72,2)),-1*Math.round(Math.pow(1,3))];var ie=!0,se=null,ae=null,ce=!1,ue=!1,de=null;const fe=new TextEncoder,me=new TextDecoder;var ye=null,ve={},ge=null,Ie=null,he=0,pe=null;async function be(){await Ee(),window.addEventListener("beforeunload",we),Y(()=>{xe()})}async function Ee(){const e=await le.get(["key"]);e.key?pe=e.key:(pe=Array.from({length:10},()=>"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[Math.floor(62*Math.random())]).join(""),await le.set({key:pe})),oe=await s(pe)}function we(){K(),window.removeEventListener("beforeunload",we),null!=se&&(se.disconnect(),se=null),null!=ae&&(ae.disconnect(),ae=null),ye=null,ve={},ge=null,Ie=null,ce=!1,he=0,pe=null}function Be(){we(),be()}function Se(){M(),D()}function xe(){(se=new MutationObserver(e=>{for(const t of e)"childList"===t.type&&(Me(t),De(t))})).observe(document.body,{childList:!0,subtree:!0})}function Me(e){if(ae)for(const t of e.removedNodes){if(t instanceof Element)b(t)&&ae&&(ae.disconnect(),ae=null)}}function De(e){if(!ae)for(const n of e.addedNodes)if(n instanceof Element){var t=b(n);if(t)return void Oe(t)}}function Oe(e){ae||(ae=new MutationObserver(_e(Se))).observe(e,{childList:!0,subtree:!0})}function _e(e){let t;return(...n)=>{clearTimeout(t);t=setTimeout(()=>{e(...n),ie=!0},ie?V:Z)}}be();