function e(e,n){_enableObserver=!1,e.before(n),_enableObserver=!0}function n(e,n){_enableObserver=!1,e.appendChild(n),_enableObserver=!0}function t(e){_enableObserver=!1,e.remove(),_enableObserver=!0}function l(e){return[...e.childNodes].filter(e=>e.nodeType===Node.TEXT_NODE||!(e.nodeType===Node.ELEMENT_NODE&&e.className.includes("timestamp"))).map(e=>e.textContent).join("").trim()}const o="https://inari-discord-api-emhndjbwfqc4enfz.canadaeast-01.azurewebsites.net",r=Object.freeze({FREE:0,BASIC:1,PREMIUM:2});async function i(e,n){const t=await chrome.runtime.sendMessage({type:"PAY_FROM_DISCORD_MESSAGE_LOGGER",planLevel:e,key:fe});t?.success?window.open(t.url,"_blank"):n&&n()}async function s(e,n){const t=await chrome.runtime.sendMessage({type:"KEY_CHECK_FROM_DISCORD_MESSAGE_LOGGER",key:e});return t?.success?t.level:(n&&n(),0)}function c(e){if(null!=e)return null!=e.querySelector('[id^="message-content"][class*="isSending"]')}function d(e){return null!=ce[de].contentsById[e.id]&&null!=ce[de].contentsById[e.id]&&(ce[de].contentsById[e.id].allEdit.length>0&&!c(ce[de].contentsById[e.id].element))}function a(e,n){return e.original!=n&&e.lastEdit!=n}function u(e){return null!=e.closest('[class*="repliedMessage"]')}function f(e){return null!=e.closest('[aria-describedby*="message-reply"]')}function m(e,n){return null!=e&&null!=e&&null!=e.element&&null!=e.element&&e.date>=n}function y(){return document.querySelectorAll('[id^="message-content"]:not([id^="message-content-Uploader"]):not([class*="repliedTextContent"]):not(.isDeleted)')}function I(e){if(null==e||null==e)return null;var n=null;return document.querySelectorAll('ol[class*="scrollerInner"] li:not([id^="deleted-"]) time').forEach(t=>{new Date(t.getAttribute("datetime"))<v(e)&&(n=t.closest("li"))}),n}function v(e){var n=e.querySelector("time");return null==n||null==n.getAttribute("datetime")?null:new Date(n.getAttribute("datetime"))}function h(e){return e.matches('[class*="chat"]')?e:e.querySelector('[class*="chat"]')}function g(){return document.querySelector('div[class*="page"] div[class*="scroller"]')}var b,B,E,p=0;function w(){de!=window.location.pathname&&(ae=de,de=window.location.pathname,p=0,null==ce[de]&&(ce[de]={contentsById:{},contentIdsByIndex:[]}))}function x(){M(),y().forEach(e=>{var n=l(e),t=ce[de].contentsById[e.id];null==t?S(e,n):(t.isDeleted=!1,a(t,n)&&(t.lastEdit=n,t.allEdit.push(n)),_(e,n))}),L(),F(),O()}function M(){b=R(),B=k(),E=T();for(var e=ce[de].contentsById,n=ce[de].contentIdsByIndex,t=b.leftIndex;t<=b.rightIndex;t++)e[n[t]].isDeleted=!0}function S(e,n){if(ue=D(),!(-1!=$[Z]&&ue>=$[Z])){ce[de].contentsById[e.id]={original:n,lastEdit:"",allEdit:[],isDeleted:!1,element:null,date:null};var t=G(e);ce[de].contentIdsByIndex.splice(t,0,e.id),A(e),le=!0}}function O(){var e=ce[de].contentIdsByIndex.length;e!=p&&(p=e)}function D(){return Object.values(ce).reduce((e,n)=>e+n.contentIdsByIndex.length,0)}function _(n,t){if(d(n)){var l="saved-"+n.id,o=document.getElementById(l),r=ce[de].contentsById[n.id];if(a(r,t)||null==o){null==o?((o=document.createElement("div")).id=l,o.className=n.className,e(n,o),n.style.display="none"):o.replaceChildren(),C(n,o,r.original," (original)");var i=ce[de].contentsById[n.id].allEdit;i.forEach((e,t)=>{1==i.length?C(n,o,e," (edited)"):C(n,o,e," (edited "+(t+1)+")")}),A(n)}}}function A(e){if(null==e.closest("li"))return ce[de].contentsById[e.id].element=null,void(ce[de].contentsById[e.id].date=null);var n=e.closest("li").cloneNode(!0);ce[de].contentsById[e.id].element=n,ce[de].contentsById[e.id].element.id="deleted-"+ce[de].contentsById[e.id].element.id,ce[de].contentsById[e.id].element.querySelectorAll('[id^="message-content"]').forEach(e=>{e.classList.add("isDeleted")}),ce[de].contentsById[e.id].date=v(n),N(ce[de].contentsById[e.id].element)}function L(){if(null!=document.querySelector('ol[class*="scrollerInner"]'))for(var e=b.leftIndex;e<=b.rightIndex;e++){var l=ce[de].contentIdsByIndex[e];if(null!=ce[de].contentsById[l].element&&null!=ce[de].contentsById[l].element)if(ce[de].contentsById[l].isDeleted&&null==document.getElementById(ce[de].contentsById[l].element.id)&&!c(ce[de].contentsById[l].element)&&m(ce[de].contentsById[l],B)){var o=I(ce[de].contentsById[l].element);null!=o&&n(o,ce[de].contentsById[l].element)}else ce[de].contentsById[l].isDeleted||null==document.getElementById(ce[de].contentsById[l].element.id)||t(ce[de].contentsById[l].element)}}function C(e,t,l,o){var r=e.querySelector('span[class*="edited"]');if(null!=r){var i=document.createElement("div");if(i.textContent=l,null!=o){var s=document.createElement("span");s.className=r.className,s.style.color="var(--text-muted)",s.textContent=o,n(i,s)}n(t,i)}}function N(){}function k(){var e=document.querySelector('ol[class*="scrollerInner"] li:not([id^="deleted-"]) time');return null==e?null:e.hasAttribute("datetime")?new Date(e.getAttribute("datetime")):null}function T(){if(!q(g())){var e=document.querySelector('ol[class*="scrollerInner"] li:not([id^="deleted-"]):last-of-type time');return null==e?null:e.hasAttribute("datetime")?new Date(e.getAttribute("datetime")):null}return null}function q(e,n=50){return null==e||null==e||e.scrollHeight-e.scrollTop-e.clientHeight<=n}function R(){var e=ce[de].contentIdsByIndex,n=ce[de].contentsById;if(!e||0===e.length)return{leftIndex:0,rightIndex:-1};for(var t=0,l=e.length;t<l;){const o=t+l>>1,r=n[e[o]];if(!r||null===r.date)break;r.date<B?t=o+1:l=o}const o=t;var r=e.length-1;if(null!=E){for(t=o,l=e.length;t<l;){const o=t+l>>1,r=n[e[o]];if(!r||null==r.date)break;r.date<=E?t=o+1:l=o}r=t-1}return{leftIndex:o,rightIndex:r}}function G(e){var n=e.closest("li"),t=new Date(v(n)),l=ce[de].contentIdsByIndex,o=ce[de].contentsById;if(!l||0===l.length)return 0;for(var r=0,i=l.length;r<i;){const e=r+i>>1,n=o[l[e]];if(!n||null===n.date)break;n.date<t?r=e+1:i=e}return r}function j(e){const n=ie.encode(e),t=X?pako.deflateRaw(n,{level:Y}):pako.deflate(n,{level:Y});let l="";for(let e=0;e<t.length;e+=32768)l+=String.fromCharCode(...t.subarray(e,e+32768));return btoa(l)}function H(e){const n=atob(e),t=new Uint8Array(n.length);for(let e=0;e<n.length;e++)t[e]=n.charCodeAt(e);const l=X?pako.inflateRaw(t):pako.inflate(t);return se.decode(l)}function z(){performance.now();const e=ce[de];if(!e)return;const n=JSON.stringify(e,(e,n)=>"element"===e&&n?n.outerHTML:n);if(re=n,!oe){oe=Q;const e=j(n),t=`logs-${de}`;V.set({[t]:e},()=>{oe=!1,re!==n&&z()})}}function F(){le&&(le=!1,z(),K(ue))}function U(e){V.get(null,n=>{for(const e in n)if(e.startsWith("logs-")){const t=e.substring(5),l=H(n[e]);ce[t]=JSON.parse(l,(e,n)=>{if("element"===e&&"string"==typeof n){const e=document.createElement("div");return e.innerHTML=n,e.firstChild}return"date"===e&&"string"==typeof n?new Date(n):n})}e&&e()})}function J(){ce={},de=null,w(),V.get(null,e=>{const n=Object.keys(e).filter(e=>e.startsWith("logs-"));V.remove(n,()=>{K(0)})})}function K(e){V.set({logsCount:e})}chrome.runtime.onMessage.addListener((e,n,t)=>{if("DELETE_ALL_LOGS"===e.type)J(),t({success:!0})});var P=100,W=500,Y=6,X=!0,Q=!1;const V=("undefined"!=typeof browser?browser:chrome).storage.local;var Z=0;const $=[Math.round(Math.pow(22.36,2)),Math.round(Math.pow(44.72,2)),-1*Math.round(Math.pow(1,3))];var ee=!0,ne=null,te=null,le=!1,oe=!1,re=null;const ie=new TextEncoder,se=new TextDecoder;var ce={},de=null,ae=null,ue=0,fe=null;async function me(){await ye(),window.addEventListener("beforeunload",Ie),U(()=>{ge()})}async function ye(){const e=await V.get(["key"]);e.key?fe=e.key:(fe=Array.from({length:10},()=>"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[Math.floor(62*Math.random())]).join(""),await V.set({key:fe})),Z=await s(fe)}function Ie(){F(),window.removeEventListener("beforeunload",Ie),null!=ne&&(ne.disconnect(),ne=null),null!=te&&(te.disconnect(),te=null),ce={},de=null,ae=null,le=!1,ue=0,fe=null}function ve(){Ie(),me()}function he(){w(),x()}function ge(){(ne=new MutationObserver(e=>{for(const n of e)"childList"===n.type&&(be(n),Be(n))})).observe(document.body,{childList:!0,subtree:!0})}function be(e){if(te)for(const n of e.removedNodes){if(n instanceof Element)h(n)&&te&&(te.disconnect(),te=null)}}function Be(e){if(!te)for(const t of e.addedNodes)if(t instanceof Element){var n=h(t);if(n)return void Ee(n)}}function Ee(e){te||(te=new MutationObserver(pe(he))).observe(e,{childList:!0,subtree:!0})}function pe(e){let n;return(...t)=>{clearTimeout(n);n=setTimeout(()=>{e(...t),ee=!0},ee?P:W)}}me();