const e=("undefined"!=typeof browser?browser:chrome).storage.local;chrome.runtime.onInstalled.addListener(e=>{"install"===e.reason&&chrome.tabs.create({url:"Config/WelcomePage.html"})}),chrome.runtime.onMessage.addListener((s,r,c)=>"GET_TOTAL_LOG_COUNT_FROM_DISCORD_MESSAGE_LOGGER_POPUP"===s.type?(chrome.tabs.query({active:!0,currentWindow:!0},([e])=>{e?.id?chrome.tabs.sendMessage(e.id,{type:"GET_TOTAL_LOG_COUNT"},e=>{chrome.runtime.lastError?c({success:!1}):c(e||{success:!1})}):c({count:null})}),!0):"DELETE_ALL_LOGS_FROM_DISCORD_MESSAGE_LOGGER_POPUP"===s.type?(chrome.tabs.query({active:!0,currentWindow:!0},([e])=>{e?.id?chrome.tabs.sendMessage(e.id,{type:"DELETE_ALL_LOGS"},e=>{chrome.runtime.lastError?c({success:!1}):c(e||{success:!1})}):c({success:!1})}),!0):"KEY_CHECK_FROM_DISCORD_MESSAGE_LOGGER"===s.type||"KEY_CHECK_FROM_DISCORD_MESSAGE_LOGGER_POPUP"===s.type?(e.get(["logsCount"],e=>{const t=e.logsCount||0;n(s.key,t).then(e=>{c(e)})}),!0):"PAY_FROM_DISCORD_MESSAGE_LOGGER"===s.type?(t(s.planLevel,s.key).then(e=>{c(e)}),!0):void 0);const s="https://inari-discord-api-emhndjbwfqc4enfz.canadaeast-01.azurewebsites.net";async function t(e,t){try{const n=await fetch(`${s}/pay`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({planLevel:e,key:t})});return{success:!0,url:(await n.json()).url}}catch(e){return{success:!1,url:""}}}async function n(e,t){try{const n=await fetch(`${s}/KeyCheck`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Key:e,CurrentLogsCount:t})});if(!n.ok)return{success:!1,level:0};return{success:!0,level:(await n.json()).level}}catch(e){return{success:!1,level:0}}}